$(function(){if(document.oncontextmenu=new Function("return false;"),document.onkeydown=document.onkeyup=document.onkeypress=function(e){var t=e||window.event||arguments.callee.caller.arguments[0];if(t){if("F11"==t.code||"F12"==t.code)return!1;"keyup"==t.type&&("ArrowLeft"==t.code?(i(),m()):"ArrowRight"==t.code?(i(),g()):"Space"==t.code?r():"Enter"==t.code&&a())}return!0},$('[data-toggle="tooltip"]').tooltip(),-1!=location.href.indexOf("drea")){var n=[{type:"热歌榜",mid:""},{type:"新歌榜",mid:""},{type:"飙升榜",mid:""},{type:"抖音榜",mid:""},{type:"电音榜",mid:""}],o=parseInt(function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e)return o[1]}return!1}("index"));o=o||((o=parseInt(localStorage.getItem("songTypeIndex")))||0),l();var c=localStorage.getItem("songList"),s=(c=c&&"undefined"!==c?JSON.parse(c):[]).length-1,e=0;let t=document.createElement("audio");function l(e){$("#list").attr("data-original-title",n[o].type),e&&$("#list").tooltip("show")}function i(){t.autoplay=!0,localStorage.setItem("paused","0")}function a(){document.fullscreenElement?($(".align-self-center").show(),function(){document.exitFullscreen&&document.exitFullscreen();document.webkitExitFullscreen&&document.webkitExitFullscreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.msExitFullscreen&&document.msExitFullscreen()}()):($(".align-self-center").hide(),function(e){e.requestFullscreen&&e.requestFullscreen();e.webkitRequestFullscreen&&e.webkitRequestFullscreen();e.mozRequestFullScreen&&e.mozRequestFullScreen();e.msRequestFullscreen&&e.msRequestFullscreen()}(document.documentElement))}function u(e,t){let n=document.createElement("a");n.style.display="none",n.href=t,n.setAttribute("download",e),document.body.appendChild(n),n.click()}function r(){t.paused?t.play():t.pause(),localStorage.setItem("paused",t.paused?"1":"0")}function d(){var e=c[s];e&&(t.src=e.url),$("#songname").text(e.name+" - "+e.singer),$("#bg").css("background-image","url("+e.pic+")")}function p(){$.post("https://open.drea.cc/openapi/res/get",{FilePath:"img/dongman/pc"},function(e){if(e.isSuccess){let t=e.data.url;$("#bg").css("background-image","url("+t+")"),$.post("https://open.drea.cc/openapi/music/rand",{type:n[o].type,mid:n[o].mid},function(e){e.isSuccess&&(e.data.pic=t,100==c.length&&c.shift(),c.push(e.data),localStorage.setItem("songList",JSON.stringify(c)),s=c.length-1,d())})}})}function m(){0<c.length?(0<s&&(s-=1),d()):p()}function g(){0<c.length&&s<c.length-1?(s+=1,d()):p()}function f(){$.get("https://open.drea.cc/openapi/AccessCount/get",{url:"drea.cc"},function(e){e.isSuccess&&$("#assessCount").text(e.data+" 人 / 次")})}t.volume=.9,t.autoplay="1"!==localStorage.getItem("paused"),t.onended=()=>{g()},t.onerror=()=>{t.autoplay&&(c.splice(s,1),localStorage.setItem("songList",JSON.stringify(c)),s-=1,++e<=5?g():(e=0,t.autoplay=!1,localStorage.setItem("paused","1")))},t.onplay=()=>{$("#pause").removeClass("pause")},t.onpause=()=>{$("#pause").addClass("pause")},t.ontimeupdate=()=>{$(".progress-bar").css("width",100*t.currentTime/t.duration+"%")},t.onended(),t.paused?$("#pause").addClass("pause"):$("#pause").removeClass("pause"),$(".progress").on("click",function(e){e=e.offsetX/$(".progress").width();$(".progress-bar").css("width",100*e+"%"),t.currentTime=t.duration*e}),$("#main").on("dblclick",function(){a()}),$("#pause").on("click",function(){r()}),$("#pre").on("click",function(){i(),m()}),$("#next").on("click",function(){i(),g()}),$("#list").on("click",function(){(o+=1)>=n.length&&(o=0),localStorage.setItem("songTypeIndex",o),l(!0),i(),g()}),$("#music").on("click",function(){var e=c[s];e&&e.name&&u(e.name,e.url)}),$("#pic").on("click",function(){var e=c[s];e&&e.name&&u(e.name,e.pic)}),$("#show").on("click",function(){$(".align-self-center").is(":visible")?$(".align-self-center").hide():$(".align-self-center").show()}),$("#max").on("click",function(){a()}),$.post("https://open.drea.cc/openapi/AccessCount/set",{url:"drea.cc"}),f(),setInterval(function(){f()},3e4)}});